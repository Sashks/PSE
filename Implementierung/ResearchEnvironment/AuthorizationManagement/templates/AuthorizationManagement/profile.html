{% extends "AuthorizationManagement/base.html" %}

{% block profile %}
	class="active";
{% endblock %}

{% block styles %}
	{% load static %}
	<link href="{% static 'AuthorizationManagement/css/home.css' %}" rel="stylesheet" type="text/css"/>
	<link rel="stylesheet" type="text/css" href="{% static 'AuthorizationManagement/css/modal_dialog_req.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'AuthorizationManagement/css/profile.css' %}" />
{% endblock %}

{% block body %}

		<h2>Profile ({{user.username}})</h2>  
		<p><strong>Name:</strong> {{ user.first_name }} {{user.last_name}} </p>
		<p><strong>E-mail:</strong> {{ user.email }}</p>
		<p><strong>Joined on:</strong> {{ user.date_joined }}</p>  
		<script>
			function showEditForm()
			{
				document.getElementById('editName').style.display="block";
				document.getElementById('name').style.display="none";
			}
		</script>
		
		<div class="body">
  	
		<button onclick="showEditForm()" class="name" id="name"><strong>{{ user.first_name }} {{user.last_name}}</strong></button>
		<form action="/profile/edit-name/" id="editName" style="display:none;" method="post">
		{% csrf_token %}
			<input type=text placeholder="{{user.first_name}}" name="firstName">
			<input type=text placeholder="{{user.last_name}}" name="lastName">
			<input type="submit" value="OK">
		</form>
		
		<p>({{user.username}})</p>

		<ul class="profile-nav">
			<li><a href="/profile/">Requests</a></li>
				
			<li><a href="/profile/my-resources">My Resources</a></li>
				
		<ul/>
		</div>
		
		
{% block requests_or_resources %}
		
			<div class="container">
			
			<h3>Requests</h3>
			{% for request in requests_list %}
				<p> Type: {{request.type}} </p>
			    <p> From: {{request.sender.username}} </p>
				<p> For: {{request.resource.name}} </p>
				<p> Description: {{request.description}} </p>
				
				<a href="#approve-request-{{request.pk}}" > accept </a>
								
				<div id="approve-request-{{request.pk}}" class="modalDialog">
					<div>
						<a href="" title="Close" class="close"> x </a>
						<form action="/approve-{{request.type}}-request/{{request.pk}}" method="post">
						{% csrf_token %}
							
							<div class="row">
								<label for="desc">Description: </label><br><br>									
                                <textarea id="descr" name = "descr" placeholder="optional" maxlength="250" cols = "50" rows = "5"></textarea>
                            </div>
							<div class="row">
								{% if request.type == 'access' %}			
									<p> Are you sure you want to approve the access request for {{request.resource.name}}? </p>
									<input id="yes" type="submit" value="yes, allow permissions">
								{% else %}
									<p> Are you sure you want to delete {{request.resource.name}}? </p>
									<input id="yes" type="submit" value="yes, delete resource">
								{% endif %}
									<button>
										<a href="" title="close" class="close"> close </a>
									</button>
							</div>
						</form>
					</div>
				</div>
				<a href="#deny-request-{{request.pk}}" > deny </a>
								
				<div id="deny-request-{{request.pk}}" class="modalDialog">
					<div>
						<a href="" title="Close" class="close"> x </a>
						<form action="/deny-{{request.type}}-request/{{request.pk}}" method="post">
						{% csrf_token %}
							
							<div class="row">									
                                <label for="desc">Description: </label><br><br>		                                    
                                <textarea id="descr" name = "descr" placeholder="optional" maxlength="250" cols = "50" rows = "5"></textarea>                                    
                            </div>
							<div class "row">
								{% if request.type == 'access' %}			
									<p> Are you sure you want to deny the access request for {{request.resource.name}}? </p>
									<input id="yes" type="submit" value="yes, deny permission">
								{% else %}
									<p> Are you sure you want to deny the deletion request for {{request.resource.name}}? </p>
									<input id="yes" type="submit" value="yes, deny deletion">
								{% endif %}
									<button>
										<a href="" title="close" class="close"> close </a>
									</button>
							</div>
						</form>
					</div>
				</div>
            {% endfor %}
            {% if is_paginated %}
			  <ul class="pagination">
			    {% if page_obj.has_previous %}
			      <li><a href="?page={{ page_obj.previous_page_number }}">&laquo;</a></li>
			    {% else %}
			      <li class="disabled"><span>&laquo;</span></li>
			    {% endif %}
			    {% for i in paginator.page_range %}
			      {% if page_obj.number == i %}
			        <li class="active"><span>{{ i }} <span class="sr-only"></span></span></li>
			      {% else %}
			        <li><a href="?page={{ i }}">{{ i }}</a></li>
			      {% endif %}
			    {% endfor %}
			    {% if page_obj.has_next %}
			      <li><a href="?page={{ page_obj.next_page_number }}">&raquo;</a></li>
			    {% else %}
			      <li class="disabled"><span>&raquo;</span></li>
			    {% endif %}
			  </ul>
			{% endif %}
	{% endblock %}
{% endblock %}	