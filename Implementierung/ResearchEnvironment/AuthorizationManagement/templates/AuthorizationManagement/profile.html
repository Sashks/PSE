{% extends "AuthorizationManagement/base.html" %}

{% block profile %}
	class="active";
{% endblock %}

{% block styles %}
	{% load static %}
	<link href="{% static 'AuthorizationManagement/css/home.css' %}" rel="stylesheet" type="text/css"/>
	<link rel="stylesheet" type="text/css" href="{% static 'AuthorizationManagement/css/modal_dialog_req.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'AuthorizationManagement/css/profile.css' %}" />	
	<link rel="stylesheet" type="text/css" href="{% static 'AuthorizationManagement/css/resources-overview.css' %}" />	
{% endblock %}

{% block body %}
 
		<script>
			function showEditForm()
			{
				document.getElementById('editName').style.display="block";
				document.getElementById('name').style.display="none";
			}
		</script>
		
		<div class="body">
  	
		<button onclick="showEditForm()" class="name" id="name"><strong>{{ user.first_name }} {{user.last_name}}</strong></button>
		<form action="/profile/edit-name/" id="editName" style="display:none;" method="post">
		{% csrf_token %}
			<input class="firstname" type=text placeholder="{{user.first_name}}" name="firstName">
			<input class="lastname" type=text placeholder="{{user.last_name}}" name="lastName">
			<input class="ok" type="submit" value="OK">
		</form>
		
		<p>({{user.username}})</p>
		
		
		</div>
		
	{% block requests_or_resources %}
	<div class="mini-nav">
			<a href="/profile/" class="current">Requests</a></li>
				
			<a href="/profile/my-resources" class="noncurrent">My Resources</a></li>
	</div>	
	
	{% if not requests_list %}
		<p class="body"> Currently no requests. </p>
	{% endif %}
		
	<!-- requests for admin user -->
{% if is_admin %}	 
		 
	<div class="admin-container">		 
		 
		 <p class="access-request"> Access Requests </p>
		 <p class="deletion-request"> Deletion Requests </p>

		{% for request in requests_list %}
			{% if request.type == 'access' %}
			<div class="admin-info">
			    <p> From: <strong>{{request.sender.username}} </strong></p>
				<p> For: <strong>{{request.resource.name}} </strong></p>
				<p> Description: <strong>{{request.description}} </strong></p>
				<p> Created on: <strong>{{request.creationDate}}</strong></p>
			</div>	
			
				<a href="#approve-request-{{request.pk}}" class="admin-accept-btn"> Accept </a>								
				<div id="approve-request-{{request.pk}}" class="modalDialog">
					<div>
						<a href="" title="Close" id="x"> x </a>
						<form action="/approve-access-request/{{request.pk}}" method="post">
						{% csrf_token %}
							
							
							<div class="row">
								<p> Are you sure you want to <strong>approve</strong> the access request for resource:
								<strong>{{request.resource.name}}</strong>? </p>
								<br>
							</div>
							<div class="row">
								<label for="desc">Message: </label><br>									
                                <textarea id="descr" name = "descr" placeholder="optional" maxlength="250" cols = "51" rows = "7"></textarea>
                            	<input id="yes" type="submit" value="Yes, allow permission">
								<a href="" title="close" id="close"> Close </a>
							</div>
						</form>
					</div>
				</div>

				<a href="#deny-request-{{request.pk}}" class="admin-deny-btn"> Deny </a>
				<div id="deny-request-{{request.pk}}" class="modalDialog">
					<div>
						<a href="" title="Close" id="x"> x </a>
						<form action="/deny-access-request/{{access_request.pk}}" method="post">
						{% csrf_token %}
							
							<div class="row" id="are-you-sure">
								<p> Are you sure you want to <strong>deny</strong> the access request for resource:
								<strong>{{request.resource.name}}</strong>? </p>
								<br>			
							</div>
							<div class="row">
								<label for="descr">Message: </label><br>									
                                <textarea id="descr" name = "descr" placeholder="optional" maxlength="250" cols = "51" rows = "7"></textarea>
                            </div>
							<input id="no" type="submit" value="Yes, deny permission">
								<a href="" title="close" id="close"> Close </a>
						</form>
					</div>
				</div>

		{% elif request.type == 'deletion' %}
			<div class="del-info">
			    <p> From: <strong>{{request.sender.username}} </strong></p>
				<p> For: <strong>{{request.resource.name}} </strong></p>
				<p> Description: <strong>{{request.description}} </strong></p>
				<p> Created on: <strong>{{request.creationDate}} </strong></p>
			</div>	
				
				<a href="#approve-request-{{request.pk}}" class="del-accept-btn"> Accept </a>
								
				<div id="approve-request-{{request.pk}}" class="modalDialog">
					<div>
						<a href="" title="Close" id="x"> x </a>
						<form action="/approve-{{request.type}}-request/{{request.pk}}" method="post">
						{% csrf_token %}							
							
							<div class="row">								
									<p> Are you sure you want to <strong>delete</strong> resource: 
									<strong>{{request.resource.name}}</strong>? </p>	
									<br>
							</div>
							<div class="row">
								<label for="descr">Message: </label><br>									
                                <textarea id="descr" name = "descr" placeholder="optional" maxlength="250" cols = auto rows = "7"></textarea>
                            </div>
							
							<input id="yes" type="submit" value="Yes, delete resource">	
							<a href="" title="close" id="close"> Close </a>
						</form>
					</div>
				</div>
		
				<a href="#deny-request-{{request.pk}}" class="del-deny-btn"> Deny </a>
								
				<div id="deny-request-{{request.pk}}" class="modalDialog">
					<div>
						<a href="" title="Close" id="x"> x </a>
						<form action="/deny-{{request.type}}-request/{{request.pk}}" method="post">
						{% csrf_token %}							
							
							<div class "row">
									<p> Are you sure you want to <strong>deny</strong> the deletion request for resource: 
									<strong>{{request.resource.name}}</strong>? </p>
									<br>
							</div>
							<div class="row">									
                                <label for="descr">Message: </label><br>		                                    
                                <textarea id="descr" name = "descr" placeholder="optional" maxlength="250" cols = "51" rows = "7"></textarea>                                    
                            </div>
							<input id="no" type="submit" value="Yes, deny deletion">
							<a href="" title="close" id="close"> Close </a>
						</form>
					</div>
				</div>
				{% endif %}
         {% endfor %}
	
	</div>
		 
		 		 
		 
		 
		<!-- requests for regular user -->
{% else %}

	<div class="container-regular-user">
			
			{% for access_request in requests_list %}
			<div class="info">
			    <p> From: <strong>{{access_request.sender.username}} </strong></p>
				<p> For: <strong>{{access_request.resource.name}} </strong></p>
				<p> Description: <strong>{{access_request.description}} </strong></p>
				<p> Created on: <strong>{{access_request.creationDate}} </strong></p>
			</div>	
			
				<a href="#approve-request-{{access_request.pk}}" class="accept-btn"> Accept </a>								
				<div id="approve-request-{{access_request.pk}}" class="modalDialog">
					<div>
						<a href="" title="Close" id="x"> x </a>
						<form action="/approve-access-request/{{access_request.pk}}" method="post">
						{% csrf_token %}
							
							
							<div class="row" id="are-you-sure">
								<p> Are you sure you want to <strong>approve</strong> the access request for resource:
								<strong>{{access_request.resource.name}}</strong>? </p>
								<br>			
							</div>
							<div class="row">
								<label for="descr">Message: </label><br>									
                                <textarea id="descr" name = "descr" placeholder="optional" maxlength="250" cols = "51" rows = "7"></textarea>
                            </div>
							<input id="yes" type="submit" value="Yes, allow permission">
								<a href="" title="close" id="close"> Close </a>
						</form>
					</div>
				</div>

				<a href="#deny-request-{{access_request.pk}}" class="deny-btn"> Deny </a>

								
				<div id="deny-request-{{access_request.pk}}" class="modalDialog">
					<div>
						<a href="" title="Close" id="x"> x </a>
						<form action="/deny-access-request/{{access_request.pk}}" method="post">
						{% csrf_token %}
							
							<div class="row" id="are-you-sure">
								<p> Are you sure you want to <strong>deny</strong> the access request for resource:
								<strong>{{access_request.resource.name}}</strong>? </p>
								<br>			
							</div>
							<div class="row">
								<label for="descr">Message: </label><br>									
                                <textarea id="descr" name = "descr" placeholder="optional" maxlength="250" cols = "51" rows = "7"></textarea>
                            </div>
							<input id="no" type="submit" value="Yes, deny permission">
								<a href="" title="close" id="close"> Close </a>
						</form>
					</div>
				</div>
            {% endfor %}		 
     			
		</div>
{% endif %}	
{% if is_paginated %}
 			  <ul class="pagination">
 			    {% if page_obj.has_previous %}
 			      <li><a href="?page={{ page_obj.previous_page_number }}">&laquo;</a></li>
 			    {% else %}
 			      <li class="disabled"><span>&laquo;</span></li>
 			    {% endif %}
 			    {% for i in paginator.page_range %}
 			      {% if page_obj.number == i %}
 			        <li class="active"><span>{{ i }} <span class="sr-only"></span></span></li>
 			      {% else %}
 			        <li><a href="?page={{ i }}">{{ i }}</a></li>
 			      {% endif %}
 			    {% endfor %}
 			    {% if page_obj.has_next %}
 			      <li><a href="?page={{ page_obj.next_page_number }}">&raquo;</a></li>
 			    {% else %}
 			      <li class="disabled"><span>&raquo;</span></li>
 			    {% endif %}
  			  </ul>
  		{% endif %}
	 
{% endblock %}		

{% endblock %}	