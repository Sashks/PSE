{% extends "AuthorizationManagement/profile.html" %}

{% block styles %}
	{% load static %}
	<link href="{% static 'AuthorizationManagement/css/resources-overview.css' %}" rel="stylesheet" type="text/css"/>
	<link href="{% static 'AuthorizationManagement/css/edit-permissions.css' %}" rel="stylesheet" type="text/css"/>
{% endblock %}

{% block body %}

<div class="search">
	<p>Search for user:</p>

	<form action="/profile/my-resources/{{resource.id}}-edit-users-permissions/search" method="get">
		<input type="text" name='q' value="{{query}}" class="search-box" placeholder="Type a username">
		<input type="submit" value="Search" class="search-btn">
	</form><br>

{% if query %}
	<p>You searched for: <strong>{{ query }}</strong></p> 
	{% if user_list %}
		<p>Found {{paginator.count }} user{{ paginator.count|pluralize }}.</p>

	{% else %}
		<p class="user-no-results">No resources matched your search criteria.</p>
	{% endif %}
{% endif %}

<div class="container-edit-permissions">

{% if user_list %}
	<form method="post">
		{% csrf_token %}
		
		{% for user in user_list %}	
		<input  type="hidden" name="usersIdsOnPage[]" value={{user.id}}>
		    
			<p class="username">{{user.username}}</p>
				
		  	{% if user in owners %}
		  	
			  	<div class="checkbox-rd1">
			    	<input  type="checkbox" name="reader[]" value={{user.id}}  checked="checked" id="{{user.id}}">
					<label for="{{user.id}}"></label>
				</div>
				<div class="checkbox-ow1">
			    	<input type="checkbox" name="owner[]" value={{user.id}}  checked="checked" id="{{user.username}}">
			    	<label  for="{{user.username}}"></label>
				</div>
				
		    {% elif user in readers %}
		    	<div class="checkbox-rd1">
			    	<input  type="checkbox" name="reader[]" value={{user.id}} checked="checked" id="{{user.email}}">
			    	<label for="{{user.email}}"></label>
				</div>
				<div class="checkbox-ow1">
			    	<input type="checkbox" name="owner[]" value={{user.id}} id="{{user.date_joined}}">
			    	<label  for="{{user.date_joined}}"></label>
		    	</div>
		    {% else %}		    	
	    		<div class="checkbox-rd1">
			    	<input  type="checkbox" name="reader[]" value={{user.id}} id="{{user.last_name}}">
			    	<label for="{{user.last_name}}"></label>
				</div>
				<div class="checkbox-ow1">
			    	<input type="checkbox" name="owner[]" value={{user.id}} id="{{user.first_name}}">
			    	<label  for="{{user.first_name}}"></label>
				</div>
		    {% endif %}	
			<br><br><br><br>
			
  		{% endfor %}
</div>
	  	<p>
	    	<button type="submit" class="confirm">Confirm</button>
	  	</p>
		<br>
	</form> 
{% endif %}

</div>

{# The pagination code below is taken from https://simpleisbetterthancomplex.com/tutorial/2016/08/03/how-to-paginate-with-django.html #}

{% if is_paginated %}
  <ul class="pagination">
    {% if page_obj.has_previous %}
      <li><a href="?{{query_pagination_string}}page={{ page_obj.previous_page_number }}">&laquo;</a></li>
    {% else %}
      <li class="disabled"><span>&laquo;</span></li>
    {% endif %}
    {% for i in paginator.page_range %}
      {% if page_obj.number == i %}
        <li class="active"><span>{{ i }} <span class="sr-only"></span></span></li>
      {% else %}
        <li><a href="?{{query_pagination_string}}page={{ i }}">{{ i }}</a></li>
      {% endif %}
    {% endfor %}
    {% if page_obj.has_next %}
      <li><a href="?{{query_pagination_string}}page={{ page_obj.next_page_number }}">&raquo;</a></li>
    {% else %}
      <li class="disabled"><span>&raquo;</span></li>
    {% endif %}
  </ul>
{% endif %}

{% endblock %}
